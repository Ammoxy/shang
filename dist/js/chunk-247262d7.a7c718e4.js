(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-247262d7"],{"129f":function(e,t){e.exports=Object.is||function(e,t){return e===t?0!==e||1/e===1/t:e!=e&&t!=t}},"466d":function(e,t,a){"use strict";var n=a("d784"),o=a("825a"),i=a("50c4"),s=a("1d80"),r=a("8aa5"),l=a("14c3");n("match",1,(function(e,t,a){return[function(t){var a=s(this),n=void 0==t?void 0:t[e];return void 0!==n?n.call(t,a):new RegExp(t)[e](String(a))},function(e){var n=a(t,e,this);if(n.done)return n.value;var s=o(e),c=String(this);if(!s.global)return l(s,c);var d=s.unicode;s.lastIndex=0;var u,h=[],g=0;while(null!==(u=l(s,c))){var p=String(u[0]);h[g]=p,""===p&&(s.lastIndex=r(c,i(s.lastIndex),d)),g++}return 0===g?null:h}]}))},"4d63":function(e,t,a){var n=a("83ab"),o=a("da84"),i=a("94ca"),s=a("7156"),r=a("9bf2").f,l=a("241c").f,c=a("44e7"),d=a("ad6d"),u=a("9f7f"),h=a("6eeb"),g=a("d039"),p=a("69f3").set,m=a("2626"),f=a("b622"),v=f("match"),b=o.RegExp,x=b.prototype,I=/a/g,y=/a/g,w=new b(I)!==I,S=u.UNSUPPORTED_Y,_=n&&i("RegExp",!w||S||g((function(){return y[v]=!1,b(I)!=I||b(y)==y||"/a/i"!=b(I,"i")})));if(_){var k=function(e,t){var a,n=this instanceof k,o=c(e),i=void 0===t;if(!n&&o&&e.constructor===k&&i)return e;w?o&&!i&&(e=e.source):e instanceof k&&(i&&(t=d.call(e)),e=e.source),S&&(a=!!t&&t.indexOf("y")>-1,a&&(t=t.replace(/y/g,"")));var r=s(w?new b(e,t):b(e,t),n?this:x,k);return S&&a&&p(r,{sticky:a}),r},$=function(e){e in k||r(k,e,{configurable:!0,get:function(){return b[e]},set:function(t){b[e]=t}})},z=l(b),D=0;while(z.length>D)$(z[D++]);x.constructor=k,k.prototype=x,h(o,"RegExp",k)}m("RegExp")},7117:function(e,t,a){},7156:function(e,t,a){var n=a("861d"),o=a("d2bb");e.exports=function(e,t,a){var i,s;return o&&"function"==typeof(i=t.constructor)&&i!==a&&n(s=i.prototype)&&s!==a.prototype&&o(e,s),e}},"80ed":function(e,t,a){"use strict";a("7117")},"841c":function(e,t,a){"use strict";var n=a("d784"),o=a("825a"),i=a("1d80"),s=a("129f"),r=a("14c3");n("search",1,(function(e,t,a){return[function(t){var a=i(this),n=void 0==t?void 0:t[e];return void 0!==n?n.call(t,a):new RegExp(t)[e](String(a))},function(e){var n=a(t,e,this);if(n.done)return n.value;var i=o(e),l=String(this),c=i.lastIndex;s(c,0)||(i.lastIndex=0);var d=r(i,l);return s(i.lastIndex,c)||(i.lastIndex=c),null===d?-1:d.index}]}))},f457:function(e,t,a){"use strict";a.r(t);var n,o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{"element-loading-text":"拼命加载中"}},[a("div",{staticClass:"handle-box"},[a("div",{staticClass:"btn"},[a("el-button",{attrs:{type:"primary"},on:{click:e.addMerchants}},[e._v("添加商家")])],1),a("div",{staticClass:"btn"},[a("el-input",{staticClass:"input-with-select",attrs:{placeholder:"请输入商家名称"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.search(e.name)}},model:{value:e.name,callback:function(t){e.name=t},expression:"name"}},[a("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:function(t){return e.search(e.name)}},slot:"append"})],1)],1)]),a("el-dialog",{attrs:{visible:e.dialogMerchants,title:"添加商家"},on:{"update:visible":function(t){e.dialogMerchants=t},close:e.close}},[a("div",{staticClass:"btn"},[a("div",{staticStyle:{margin:"0 30px"}},[a("h3",{staticStyle:{height:"40px","line-height":"40px"}},[e._v("商家名称")]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.merchantInfo.name,expression:"merchantInfo.name"}],staticStyle:{width:"100%",height:"30px","line-height":"30px","font-size":"15px"},attrs:{type:"text"},domProps:{value:e.merchantInfo.name},on:{input:function(t){t.target.composing||e.$set(e.merchantInfo,"name",t.target.value)}}}),a("h3",{staticStyle:{height:"40px","line-height":"40px"}},[e._v("商家简介")]),a("textarea",{directives:[{name:"model",rawName:"v-model",value:e.merchantInfo.intro,expression:"merchantInfo.intro"}],staticStyle:{width:"100%",height:"90px","font-size":"15px"},attrs:{name:"intro"},domProps:{value:e.merchantInfo.intro},on:{input:function(t){t.target.composing||e.$set(e.merchantInfo,"intro",t.target.value)}}}),a("h3",{staticStyle:{height:"40px","line-height":"40px"}},[e._v("商家地址")]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.merchantInfo.address,expression:"merchantInfo.address"}],staticStyle:{width:"100%",height:"30px","line-height":"30px","font-size":"15px"},attrs:{type:"text"},domProps:{value:e.merchantInfo.address},on:{input:function(t){t.target.composing||e.$set(e.merchantInfo,"address",t.target.value)}}}),a("h3",{staticStyle:{height:"40px","line-height":"40px"}},[e._v("商家logo")]),a("el-upload",{ref:"upload",attrs:{action:"https://api.fengniaotuangou.cn/api/upload",limit:1,"before-upload":e.beforeAvatarUpload,"on-success":e.handleAvatarSuccess,"on-remove":e.handleRemove,"on-exceed":e.handleExceed}},[a("el-button",{attrs:{size:"small",type:"primary"}},[e._v("选择图片")])],1),e.hasNewImage?a("div",{staticStyle:{color:"red","font-size":"12px"}},[e._v("* 点击文件名可删除所选图片")]):e._e(),a("div",{staticClass:"up-img"},[a("img",{staticClass:"auto-img",attrs:{src:e.imageUrl}})]),a("h3",{staticStyle:{height:"40px","line-height":"40px"}},[e._v("批量上传商家详情图片")]),a("el-upload",{ref:"upload",attrs:{action:"https://api.fengniaotuangou.cn/api/upload",limit:9,"before-upload":e.beforeAvatarUpload1,"on-remove":e.handleRemove1,"on-exceed":e.handleExceed1,"auto-upload":!0,"on-change":e.handleChange1,multiple:"","list-type":"picture-card","file-list":e.fileLists,"on-success":e.handleAvatarSuccess1}},[a("i",{staticClass:"el-icon-plus",attrs:{slot:"default"},slot:"default"})]),a("h3",{staticStyle:{height:"40px","line-height":"40px"}},[e._v("商家详情")]),a("quill-editor",{ref:"myQuillEditor",staticStyle:{height:"430px",margin:"0 0 60px 0"},attrs:{options:e.editorOption},model:{value:e.merchantInfo.detail,callback:function(t){e.$set(e.merchantInfo,"detail",t)},expression:"merchantInfo.detail"}}),a("el-upload",{staticClass:"avatar-uploader quill-img",staticStyle:{display:"none"},attrs:{action:"https://api.fengniaotuangou.cn/api/upload","before-upload":e.beforeUpload,"on-success":e.quillImgSuccess}},[a("el-button",{attrs:{size:"small",type:"primary",id:"imgInput","element-loading-text":"插入中,请稍候"}},[e._v("点击上传")])],1),a("div",{staticClass:"submit"},[a("el-button",{attrs:{type:"primary"},on:{click:e.newMerchants}},[e._v("提交")])],1)],1)])]),a("el-table",{attrs:{data:e.tableData,"empty-text":"暂无数据",border:"","header-cell-style":{background:"#f0f0f0"},"max-height":"620"}},[a("el-table-column",{attrs:{prop:"id",label:"ID"}}),a("el-table-column",{attrs:{prop:"name",label:"商家名称"}}),a("el-table-column",{attrs:{prop:"address",label:"地址",width:"180px"}}),a("el-table-column",{attrs:{prop:"img",label:"商家logo"},scopedSlots:e._u([{key:"default",fn:function(e){return[a("img",{staticStyle:{"max-width":"180px","max-height":"80px"},attrs:{src:e.row.img}})]}}])}),a("el-table-column",{attrs:{prop:"created_at",label:"创建时间"}}),a("el-table-column",{attrs:{label:"操作",width:"300px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(a){return e.handleDetail(t.$index,t.row)}}},[e._v("编辑")]),a("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(a){return e.handleDel(t.$index,t.row)}}},[e._v("删除")])]}}])})],1),a("div",{staticClass:"block"},[a("el-pagination",{attrs:{"current-page":e.current,"page-sizes":[10,20,30,40,50],"page-size":e.size,layout:"sizes, prev, pager, next, jumper",total:e.total},on:{"current-change":e.currentChange,"update:currentPage":function(t){e.current=t},"update:current-page":function(t){e.current=t},"size-change":e.sizeChange}})],1),a("el-dialog",{attrs:{visible:e.dialogDel,title:"删除商家",width:"20%",align:"center","close-on-click-modal":!1},on:{"update:visible":function(t){e.dialogDel=t}}},[a("div",{staticStyle:{"font-size":"20px","margin-bottom":"30px"}},[e._v("是否删除该商家")]),a("span",[a("el-button",{attrs:{type:"primary"},on:{click:e.toDel}},[e._v("删除")]),a("el-button",{attrs:{type:"danger"},on:{click:function(t){e.dialogDel=!1}}},[e._v("取消")])],1)])],1)},i=[],s=(a("c975"),a("d81d"),a("a434"),a("b0c0"),a("d3b7"),a("3ca3"),a("ddb0"),a("2b3d"),a("365c")),r=(a("3022"),a("8d81"),a("953d")),l=(a("a7539"),a("8096"),a("14e1"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"login-wrap"})}),c=[],d=(a("99af"),a("4d63"),a("ac1f"),a("25f0"),a("466d"),a("841c"),"https://school.fengniaotuangou.cn/api/mandate"),u="https://qi.fengniaotuangou.cn",h="https://school.fengniaotuangou.cn",g="wx3e9beec21e207233",p=(sessionStorage.getItem("token"),sessionStorage.getItem("token"),sessionStorage.getItem("token"),{"content-type":"application/x-www-form-urlencoded"}),m={userInfor:JSON.parse(sessionStorage.getItem("userInfor"))},f=function(e){console.log("封装微信登录接口"),window.location.href="https://open.weixin.qq.com/connect/oauth2/authorize?appid=".concat(g,"&redirect_uri=").concat(u,"&response_type=code&scope=snsapi_base&state=").concat(e,"#wechat_redirect")},v=function(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),a=window.location.search.substr(1).match(t);return null!=a?decodeURIComponent(a[2]):null},b=function(e,t){$.ajax({type:"get",url:h+"/api/mandate/school",data:e,success:function(e){t(e)}})},x=function(e,t){$.ajax({type:"get",url:d+"/user/getUser",data:e,success:function(e){t(e)}})},I=function(e,t){$.ajax({type:"get",url:h+"/api/access/token",data:e,headers:p,success:function(e){t(e)}})},y={data:function(){return{code:"",state:"",school:"",user_id:""}},created:function(){console.log(1),this.$toast.loading("登录中..."),console.log(window.location),this.code=v("code"),this.state=v("state"),this.school=v("school"),this.user_id=v("user_id"),console.log("code ==>"+this.code),console.log(11,"state="+this.state),I({name:"校园安全系统"},(function(e){})),this.code?this.GetOpenId(this.code):(console.log(3),f(this.state))},methods:{GetOpenId:function(e){console.log("获取OpenId  GetOpenId");var t=this;console.log("123",t.code),b({code:t.code,name:"校园安全系统"},(function(e){console.log("获取OpenId"),console.log("callback.data",e.data),e.data?(sessionStorage.setItem("openId",e.data),"empty-1"===t.state?(console.log(123456,t.state),t.$router.push("/empty-1?school="+sessionStorage.getItem("school")+"&user_id="+sessionStorage.getItem("user_id")+"&open_id="+sessionStorage.getItem("openId"))):"empty"===t.state?(console.log(234,t.state),t.$router.push("/empty?school="+sessionStorage.getItem("school")+"&user_id="+sessionStorage.getItem("user_id")+"&open_id="+sessionStorage.getItem("openId"))):(console.log(123444),t.$router.push("/"+t.state))):t.$toast.fail("请关注公众号")}))},GetUserInfo:function(){var e=this;x({user_openid:sessionStorage.getItem("openId")},(function(t){console.log("11111,用户信息"),console.log(t.user),"ok"===t.msg?(sessionStorage.setItem("userInfor",JSON.stringify(t.user)),m.userInfor=t.user,e.$router.push("/personal")):(console.log("2222,用户信息"),e.$router.push("/userInfo"))}))}}},w=y,S=a("2877"),_=Object(S["a"])(w,l,c,!1,null,"11b68396",null),k=(_.exports,{inject:["reload"],components:{quillEditor:r["quillEditor"]},data:function(){return{loading:!0,tableData:[],current:1,size:10,total:0,id:"",dialogDel:!1,dialogMerchants:!1,editorOption:{placeholder:"请输入文档内容",theme:"snow",modules:{toolbar:{container:[["bold","italic","underline","strike"],["blockquote","code-block"],[{direction:"rtl"}],[{size:["small",!1,"large","huge"]}],[{header:[1,2,3,4,5,6,!1]}],[{color:[]},{background:[]}],[{font:[]}],[{align:[]}],["clean"],["link","image"]],handlers:{image:function(e){e?document.querySelector(".quill-img input").click():this.quill.format("image",!1)}}}}},merchantInfo:{name:"",intro:"",detail:"",img:"",address:"",imgs:[],id:""},imageUrl:"",hasNewImage:!1,hasNewImage1:!1,name:"",fileLists:[]}},mounted:function(){this.getList()},methods:{getList:function(){var e=this;s["a"].merchants(e.current,e.size).then((function(t){e.loading=!1,e.tableData=t.data,e.total=t.total})).catch((function(t){e.loading=!1}))},search:function(){var e=this;s["a"].merchants(e.current,e.size,e.name).then((function(t){e.loading=!1,e.tableData=t.data,e.total=t.total})).catch((function(t){e.loading=!1}))},currentChange:function(e){var t=this;t.current=e,t.loading=!0,t.name?s["a"].merchants(e,t.size,t.name).then((function(e){t.loading=!1,t.tableData=e.data,t.total=e.total})).catch((function(e){t.loading=!1})):s["a"].merchants(e,t.size).then((function(e){t.loading=!1,t.tableData=e.data,t.total=e.total})).catch((function(e){t.loading=!1}))},sizeChange:function(e){var t=this;t.size=e,t.loading=!0,t.name?s["a"].merchants(t.current,e,t.name).then((function(e){t.loading=!1,t.tableData=e.data,t.total=e.total})).catch((function(e){t.loading=!1})):s["a"].merchants(t.current,e).then((function(e){t.loading=!1,t.tableData=e.data,t.total=e.total})).catch((function(e){t.loading=!1}))},addMerchants:function(){var e=this;e.dialogMerchants=!0,e.hasNewImage=!1,e.hasNewImage1=!1,e.merchantInfo={name:"",intro:"",detail:"",img:"",address:"",imgs:[],id:""},e.imageUrl=""},newMerchants:function(){var e=this;s["a"].createMerchants(e.merchantInfo).then((function(t){e.$message.success("提交成功"),e.dialogMerchants=!1,e.merchantInfo={name:"",intro:"",detail:"",img:"",address:"",imgs:[],id:""},e.imageUrl="",e.getList()}))},beforeUpload:function(){n=this.$loading({lock:!0,text:"图片上传中",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"})},quillImgSuccess:function(e,t){var a=this.$refs.myQuillEditor.quill;if(n.close(),e.data){var o=a.getSelection().index;a.insertEmbed(o,"image",e.data),a.setSelection(o+1)}else this.$message.error("图片插入失败")},handleRemove:function(e,t){var a=this;a.imageUrl="",a.hasNewImage=!1},beforeAvatarUpload:function(e){var t=e.size/1024/1024<2;return t||this.$message.error("上传图片大小不能超过 2MB!"),t},handleAvatarSuccess:function(e,t){var a=this;a.imageUrl=URL.createObjectURL(t.raw),a.$message.success("上传成功"),a.merchantInfo.img=t.response.data,a.hasNewImage=!0},handleExceed:function(e,t){var a=this;a.$message.error("上传图片不能超过1张!"),a.$refs.upload.clearFiles(),a.imageUrl=""},handleRemove1:function(e,t){var a=this;console.log(e),a.fileLists=t,a.merchantInfo.imgs.splice(a.merchantInfo.imgs.indexOf(e.url),1),console.log(a.merchantInfo.imgs),a.hasNewImage1=!1},beforeAvatarUpload1:function(e){this.fileLists.length>9&&this.$message.error("最多只能上传9张图片");var t=e.size/1024<500;return t||this.$message.error("上传产品图片大小不能超过 500K!"),t&&this.fileLists.length<=9},handleAvatarSuccess1:function(e,t){var a=this;a.merchantInfo.imgs.push(t.response.data)},handleExceed1:function(e,t){var a=this;a.$message.error("上传图片不能超过9张!"),a.$refs.upload.clearFiles()},handleChange1:function(e,t){var a=this;a.fileLists=t},handleDel:function(e,t){var a=this;a.dialogDel=!0,a.id=t.id},toDel:function(){var e=this;s["a"].DelMerchant(e.id).then((function(t){e.$message.success("删除成功"),e.dialogDel=!1,e.getList()}))},handleDetail:function(e,t){var a=this;a.dialogMerchants=!0,a.id=t.id,a.merchantInfo={name:t.name,intro:t.intro,detail:t.detail,img:t.img,address:t.address,imgs:t.imgs,id:t.id},a.imageUrl=t.img,a.fileLists=a.merchantInfo.imgs.map((function(e){var t={};return t.url=e,t}))},close:function(){var e=this;e.fileLists=[]}}}),z=k,D=(a("80ed"),Object(S["a"])(z,o,i,!1,null,"4430f438",null));t["default"]=D.exports}}]);
//# sourceMappingURL=chunk-247262d7.a7c718e4.js.map