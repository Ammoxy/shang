(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5ef927a6"],{"129f":function(e,t){e.exports=Object.is||function(e,t){return e===t?0!==e||1/e===1/t:e!=e&&t!=t}},"466d":function(e,t,n){"use strict";var a=n("d784"),o=n("825a"),i=n("50c4"),s=n("1d80"),l=n("8aa5"),r=n("14c3");a("match",1,(function(e,t,n){return[function(t){var n=s(this),a=void 0==t?void 0:t[e];return void 0!==a?a.call(t,n):new RegExp(t)[e](String(n))},function(e){var a=n(t,e,this);if(a.done)return a.value;var s=o(e),c=String(this);if(!s.global)return r(s,c);var u=s.unicode;s.lastIndex=0;var d,f=[],h=0;while(null!==(d=r(s,c))){var g=String(d[0]);f[h]=g,""===g&&(s.lastIndex=l(c,i(s.lastIndex),u)),h++}return 0===h?null:f}]}))},"4d63":function(e,t,n){var a=n("83ab"),o=n("da84"),i=n("94ca"),s=n("7156"),l=n("9bf2").f,r=n("241c").f,c=n("44e7"),u=n("ad6d"),d=n("9f7f"),f=n("6eeb"),h=n("d039"),g=n("69f3").set,m=n("2626"),p=n("b622"),v=p("match"),b=o.RegExp,I=b.prototype,x=/a/g,y=/a/g,w=new b(x)!==x,k=d.UNSUPPORTED_Y,S=a&&i("RegExp",!w||k||h((function(){return y[v]=!1,b(x)!=x||b(y)==y||"/a/i"!=b(x,"i")})));if(S){var $=function(e,t){var n,a=this instanceof $,o=c(e),i=void 0===t;if(!a&&o&&e.constructor===$&&i)return e;w?o&&!i&&(e=e.source):e instanceof $&&(i&&(t=u.call(e)),e=e.source),k&&(n=!!t&&t.indexOf("y")>-1,n&&(t=t.replace(/y/g,"")));var l=s(w?new b(e,t):b(e,t),a?this:I,$);return k&&n&&g(l,{sticky:n}),l},_=function(e){e in $||l($,e,{configurable:!0,get:function(){return b[e]},set:function(t){b[e]=t}})},D=r(b),E=0;while(D.length>E)_(D[E++]);I.constructor=$,$.prototype=I,f(o,"RegExp",$)}m("RegExp")},7156:function(e,t,n){var a=n("861d"),o=n("d2bb");e.exports=function(e,t,n){var i,s;return o&&"function"==typeof(i=t.constructor)&&i!==n&&a(s=i.prototype)&&s!==n.prototype&&o(e,s),e}},"841c":function(e,t,n){"use strict";var a=n("d784"),o=n("825a"),i=n("1d80"),s=n("129f"),l=n("14c3");a("search",1,(function(e,t,n){return[function(t){var n=i(this),a=void 0==t?void 0:t[e];return void 0!==a?a.call(t,n):new RegExp(t)[e](String(n))},function(e){var a=n(t,e,this);if(a.done)return a.value;var i=o(e),r=String(this),c=i.lastIndex;s(c,0)||(i.lastIndex=0);var u=l(i,r);return s(i.lastIndex,c)||(i.lastIndex=c),null===u?-1:u.index}]}))},cac5:function(e,t,n){},d742:function(e,t,n){"use strict";n("cac5")},f457:function(e,t,n){"use strict";n.r(t);var a,o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{"element-loading-text":"拼命加载中"}},[n("div",{staticClass:"handle-box"},[n("div",{staticClass:"btn"},[n("el-button",{attrs:{type:"primary"},on:{click:e.addMerchants}},[e._v("添加商家")])],1),n("div",{staticClass:"btn"},[n("el-input",{staticClass:"input-with-select",attrs:{placeholder:"请输入商家名称"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.search(e.name)}},model:{value:e.name,callback:function(t){e.name=t},expression:"name"}},[n("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:function(t){return e.search(e.name)}},slot:"append"})],1)],1)]),n("el-dialog",{attrs:{visible:e.dialogMerchants,title:"添加商家",width:"1000px"},on:{"update:visible":function(t){e.dialogMerchants=t},close:e.close}},[n("el-form",{attrs:{"label-width":"80px",model:e.merchantInfo}},[n("el-form-item",{attrs:{label:"商家名称"}},[n("el-input",{model:{value:e.merchantInfo.name,callback:function(t){e.$set(e.merchantInfo,"name",t)},expression:"merchantInfo.name"}})],1),n("el-form-item",{attrs:{label:"商家简介"}},[n("el-input",{model:{value:e.merchantInfo.intro,callback:function(t){e.$set(e.merchantInfo,"intro",t)},expression:"merchantInfo.intro"}})],1),n("el-form-item",{attrs:{label:"商家地址"}},[n("el-input",{model:{value:e.merchantInfo.address,callback:function(t){e.$set(e.merchantInfo,"address",t)},expression:"merchantInfo.address"}})],1),n("el-form-item",{attrs:{label:"商家logo"}},[n("el-upload",{ref:"upload",attrs:{action:"https://api.fengniaotuangou.cn/api/upload",limit:1,"before-upload":e.beforeAvatarUpload,"on-success":e.handleAvatarSuccess,"on-remove":e.handleRemove,"on-exceed":e.handleExceed,"auto-upload":!0,"on-change":e.handleChange,"list-type":"picture-card","file-list":e.files}},[n("i",{staticClass:"el-icon-plus",attrs:{slot:"default"},slot:"default"})])],1),n("el-form-item",{attrs:{label:"批量上传详情图片"}},[n("el-upload",{ref:"upload",attrs:{action:"https://api.fengniaotuangou.cn/api/upload",limit:9,"before-upload":e.beforeAvatarUpload1,"on-remove":e.handleRemove1,"on-exceed":e.handleExceed1,"auto-upload":!0,"on-change":e.handleChange1,multiple:"","list-type":"picture-card","file-list":e.fileLists,"on-success":e.handleAvatarSuccess1}},[n("i",{staticClass:"el-icon-plus",attrs:{slot:"default"},slot:"default"})])],1),n("el-form-item",{attrs:{label:"商家详情"}},[n("quill-editor",{ref:"myQuillEditor",staticStyle:{height:"430px",margin:"0 0 60px 0"},attrs:{options:e.editorOption},model:{value:e.merchantInfo.detail,callback:function(t){e.$set(e.merchantInfo,"detail",t)},expression:"merchantInfo.detail"}}),n("el-upload",{staticClass:"avatar-uploader quill-img",staticStyle:{display:"none"},attrs:{action:"https://api.fengniaotuangou.cn/api/upload","before-upload":e.beforeUpload,"on-success":e.quillImgSuccess}},[n("el-button",{attrs:{size:"small",type:"primary",id:"imgInput","element-loading-text":"插入中,请稍候"}},[e._v("点击上传")])],1)],1),n("div",{staticClass:"submit"},[n("el-form-item",[n("el-button",{attrs:{type:"primary"},on:{click:e.newMerchants}},[e._v("提交")])],1)],1)],1)],1),n("el-table",{attrs:{data:e.tableData,"empty-text":"暂无数据",border:"","header-cell-style":{background:"#f5f7fa"},"max-height":"620"}},[n("el-table-column",{attrs:{prop:"id",label:"ID"}}),n("el-table-column",{attrs:{prop:"name",label:"商家名称"}}),n("el-table-column",{attrs:{prop:"address",label:"地址",width:"180px"}}),n("el-table-column",{attrs:{prop:"img",label:"商家logo"},scopedSlots:e._u([{key:"default",fn:function(e){return[n("img",{staticStyle:{"max-width":"180px","max-height":"80px"},attrs:{src:e.row.img}})]}}])}),n("el-table-column",{attrs:{prop:"created_at",label:"创建时间"}}),n("el-table-column",{attrs:{label:"操作",width:"300px"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-button",{attrs:{type:"primary",icon:"el-icon-edit",size:"mini"},on:{click:function(n){return e.handleDetail(t.$index,t.row)}}}),n("el-button",{attrs:{type:"danger",icon:"el-icon-delete",size:"mini"},on:{click:function(n){return e.handleDel(t.$index,t.row)}}})]}}])})],1),n("div",{staticClass:"block"},[n("el-pagination",{attrs:{"current-page":e.current,"page-sizes":[10,20,30,40,50],"page-size":e.size,layout:"sizes, prev, pager, next, jumper",total:e.total},on:{"current-change":e.currentChange,"update:currentPage":function(t){e.current=t},"update:current-page":function(t){e.current=t},"size-change":e.sizeChange}})],1),n("el-dialog",{attrs:{visible:e.dialogDel,title:"删除商家",width:"20%",align:"center","close-on-click-modal":!1},on:{"update:visible":function(t){e.dialogDel=t}}},[n("div",{staticStyle:{"font-size":"20px","margin-bottom":"30px"}},[e._v("是否删除该商家")]),n("span",[n("el-button",{attrs:{type:"primary"},on:{click:e.toDel}},[e._v("删除")]),n("el-button",{attrs:{type:"danger"},on:{click:function(t){e.dialogDel=!1}}},[e._v("取消")])],1)])],1)},i=[],s=(n("4160"),n("c975"),n("d81d"),n("a434"),n("b0c0"),n("ac1f"),n("1276"),n("159b"),n("365c")),l=(n("3022"),n("8d81"),n("953d")),r=(n("a7539"),n("8096"),n("14e1"),function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"login-wrap"})}),c=[],u=(n("99af"),n("4d63"),n("25f0"),n("466d"),n("841c"),"https://school.fengniaotuangou.cn/api/mandate"),d="https://qi.fengniaotuangou.cn",f="https://school.fengniaotuangou.cn",h="wx3e9beec21e207233",g=(sessionStorage.getItem("token"),sessionStorage.getItem("token"),sessionStorage.getItem("token"),{"content-type":"application/x-www-form-urlencoded"}),m={userInfor:JSON.parse(sessionStorage.getItem("userInfor"))},p=function(e){console.log("封装微信登录接口"),window.location.href="https://open.weixin.qq.com/connect/oauth2/authorize?appid=".concat(h,"&redirect_uri=").concat(d,"&response_type=code&scope=snsapi_base&state=").concat(e,"#wechat_redirect")},v=function(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),n=window.location.search.substr(1).match(t);return null!=n?decodeURIComponent(n[2]):null},b=function(e,t){$.ajax({type:"get",url:f+"/api/mandate/school",data:e,success:function(e){t(e)}})},I=function(e,t){$.ajax({type:"get",url:u+"/user/getUser",data:e,success:function(e){t(e)}})},x=function(e,t){$.ajax({type:"get",url:f+"/api/access/token",data:e,headers:g,success:function(e){t(e)}})},y={data:function(){return{code:"",state:"",school:"",user_id:""}},created:function(){console.log(1),this.$toast.loading("登录中..."),console.log(window.location),this.code=v("code"),this.state=v("state"),this.school=v("school"),this.user_id=v("user_id"),console.log("code ==>"+this.code),console.log(11,"state="+this.state),x({name:"校园安全系统"},(function(e){})),this.code?this.GetOpenId(this.code):(console.log(3),p(this.state))},methods:{GetOpenId:function(e){console.log("获取OpenId  GetOpenId");var t=this;console.log("123",t.code),b({code:t.code,name:"校园安全系统"},(function(e){console.log("获取OpenId"),console.log("callback.data",e.data),e.data?(sessionStorage.setItem("openId",e.data),"empty-1"===t.state?(console.log(123456,t.state),t.$router.push("/empty-1?school="+sessionStorage.getItem("school")+"&user_id="+sessionStorage.getItem("user_id")+"&open_id="+sessionStorage.getItem("openId"))):"empty"===t.state?(console.log(234,t.state),t.$router.push("/empty?school="+sessionStorage.getItem("school")+"&user_id="+sessionStorage.getItem("user_id")+"&open_id="+sessionStorage.getItem("openId"))):(console.log(123444),t.$router.push("/"+t.state))):t.$toast.fail("请关注公众号")}))},GetUserInfo:function(){var e=this;I({user_openid:sessionStorage.getItem("openId")},(function(t){console.log("11111,用户信息"),console.log(t.user),"ok"===t.msg?(sessionStorage.setItem("userInfor",JSON.stringify(t.user)),m.userInfor=t.user,e.$router.push("/personal")):(console.log("2222,用户信息"),e.$router.push("/userInfo"))}))}}},w=y,k=n("2877"),S=Object(k["a"])(w,r,c,!1,null,"11b68396",null),_=(S.exports,{inject:["reload"],components:{quillEditor:l["quillEditor"]},data:function(){return{loading:!0,tableData:[],current:1,size:10,total:0,id:"",dialogDel:!1,dialogMerchants:!1,editorOption:{placeholder:"请输入文档内容",theme:"snow",modules:{toolbar:{container:[["bold","italic","underline","strike"],["blockquote","code-block"],[{direction:"rtl"}],[{size:["small",!1,"large","huge"]}],[{header:[1,2,3,4,5,6,!1]}],[{color:[]},{background:[]}],[{font:[]}],[{align:[]}],["clean"],["link","image"]],handlers:{image:function(e){e?document.querySelector(".quill-img input").click():this.quill.format("image",!1)}}}}},merchantInfo:{name:"",intro:"",detail:"",img:"",address:"",imgs:[],id:""},name:"",fileLists:[],files:[]}},mounted:function(){this.getList()},methods:{getList:function(){var e=this;s["a"].merchants(e.current,e.size).then((function(t){e.loading=!1,e.tableData=t.data,e.total=t.total})).catch((function(t){e.loading=!1}))},search:function(){var e=this;s["a"].merchants(e.current,e.size,e.name).then((function(t){e.loading=!1,e.tableData=t.data,e.total=t.total})).catch((function(t){e.loading=!1}))},currentChange:function(e){var t=this;t.current=e,t.loading=!0,t.name?s["a"].merchants(e,t.size,t.name).then((function(e){t.loading=!1,t.tableData=e.data,t.total=e.total})).catch((function(e){t.loading=!1})):s["a"].merchants(e,t.size).then((function(e){t.loading=!1,t.tableData=e.data,t.total=e.total})).catch((function(e){t.loading=!1}))},sizeChange:function(e){var t=this;t.size=e,t.loading=!0,t.name?s["a"].merchants(t.current,e,t.name).then((function(e){t.loading=!1,t.tableData=e.data,t.total=e.total})).catch((function(e){t.loading=!1})):s["a"].merchants(t.current,e).then((function(e){t.loading=!1,t.tableData=e.data,t.total=e.total})).catch((function(e){t.loading=!1}))},addMerchants:function(){var e=this;e.dialogMerchants=!0,e.hasNewImage=!1,e.hasNewImage1=!1,e.merchantInfo={name:"",intro:"",detail:"",img:"",address:"",imgs:[],id:""}},newMerchants:function(){var e=this;s["a"].createMerchants(e.merchantInfo).then((function(t){e.$message.success("提交成功"),e.dialogMerchants=!1,e.merchantInfo={name:"",intro:"",detail:"",img:"",address:"",imgs:[],id:""},e.getList()}))},beforeUpload:function(){a=this.$loading({lock:!0,text:"图片上传中",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"})},quillImgSuccess:function(e,t){var n=this.$refs.myQuillEditor.quill;if(a.close(),e.data){var o=n.getSelection().index;n.insertEmbed(o,"image",e.data),n.setSelection(o+1)}else this.$message.error("图片插入失败")},handleRemove:function(e,t){var n=this;n.files=t,n.merchantInfo.img=""},beforeAvatarUpload:function(e){var t=307200;return t||this.$message.error("上传图片大小不能超过300KB"),t},handleAvatarSuccess:function(e,t){var n=this;n.merchantInfo.img=t.response.data},handleExceed:function(e,t){var n=this;n.$message.error("上传图片不能超过1张!")},handleChange:function(e,t){var n=this;n.files=t},handleRemove1:function(e,t){var n=this;n.fileLists=t,n.merchantInfo.imgs.splice(n.merchantInfo.imgs.indexOf(e.url),1)},beforeAvatarUpload1:function(e){this.fileLists.length>9&&this.$message.error("最多只能上传9张图片");var t=e.size/1024<500;return t||this.$message.error("上传产品图片大小不能超过 500K!"),t&&this.fileLists.length<=9},handleAvatarSuccess1:function(e,t){var n=this;n.merchantInfo.imgs.push(t.response.data)},handleExceed1:function(e,t){var n=this;n.$message.error("上传图片不能超过9张!")},handleChange1:function(e,t){var n=this;n.fileLists=t},handleDel:function(e,t){var n=this;n.dialogDel=!0,n.id=t.id},toDel:function(){var e=this;s["a"].DelMerchant(e.id).then((function(t){e.$message.success("删除成功"),e.dialogDel=!1,e.getList()}))},handleDetail:function(e,t){var n=this;n.dialogMerchants=!0,n.id=t.id,n.merchantInfo={name:t.name,intro:t.intro,detail:t.detail,img:t.img,address:t.address,imgs:t.imgs,id:t.id},n.fileLists=n.merchantInfo.imgs.map((function(e){var t={};return t.url=e,t}));var a=n.merchantInfo.img.split(",");a.forEach((function(e){var t=new Object;t.url=e,n.files.push(t)}))},close:function(){var e=this;e.fileLists=[],e.files=[]}}}),D=_,E=(n("d742"),Object(k["a"])(D,o,i,!1,null,"313b73fb",null));t["default"]=E.exports}}]);
//# sourceMappingURL=chunk-5ef927a6.eb8451ba.js.map